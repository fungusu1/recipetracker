<!DOCTYPE html>
<html lang="en">

<head>
  <title>Recipe Index</title>
  <link rel="stylesheet" href="../css/CRecipe.css">
  <link rel="stylesheet" href="../css/header.css">
  <link rel="stylesheet" href="../css/Home.css">
  <link rel="stylesheet" href="../css/Browser.css">
</head>

<body class="page-body">
  <!--  Header  -->
  <header class="header">
    <div class="header-left">
      <a href="/">Recipe Index</a>
      <a href="/browse" class="nav-link">Breakfast</a>
      <a href="/browse" class="nav-link">Lunch</a>
      <a href="/browse" class="nav-link">Dinner</a>
    </div>
    <div class="header-center">
      <input type="text" placeholder="Search recipes...">
    </div>
    <div class="header-right">
      <!-- Different header if user is logged in -->
      {% if current_user.is_authenticated %}
      <a href="/logout" class="nav-link">Log Out</a>
      {% else %}
      <a href="/login" class="nav-link">Log In</a>
      <a href="/signup" class="nav-link">Sign Up</a>
      {% endif %}
      <button onclick="location.href='/create'">Create!</button>
      <a href="/profile" class="profile-link">Profile</a>
    </div>
  </header>

  <!-- Flash msgs -->
  <div class="flash-container">
    {% with messages = get_flashed_messages(with_categories=True) %}
      {% if messages %}
        {% for category, msg in messages %}
          <p class="flash-msg {{ category }}">{{ msg }}</p>
        {% endfor %}
      {% endif %}
    {% endwith %}
  </div>

  <!--  Page Content  -->
  <div class="welcome-box">
    <h1>Welcome to Recipe Index</h1>
    <p>Create, organise, and share your favourite recipes!</p>
    <p>Explore a variety of recipes from different cuisines for different meal types.</p>

    <h2>Sign up to join our community and share your recipes with us today!</h2>
    {% if current_user.is_authenticated %}
    <p><strong><u>Welcome back, {{ current_user.display_name }}!</u></strong></p>
    <button onclick="location.href='/profile'">Go to Profile</button>
    <button onclick="location.href='/create'">Create a Recipe</button>
    {% else %}
    <button onclick="location.href='/signup'">Sign Up</button>
    <button onclick="location.href='/login'">Log In</button>
    {% endif %}
  </div>

  <div class="browse-button-section">
    <button onclick="location.href='/browse'">Browse All Recipes ></button>
  </div>

  <div class="top-recipes-section">
    <h2>Top Recipes</h2>
    <div class="top-recipes-grid">
      <!-- Top Recipes Section (based on rating)-->
      {% for recipe in top_recipes %}
        <div class="recipe-preview" onclick="location.href='/recipe?id={{ recipe.id }}'">
          <img src="{{ recipe.images[0].image_url if recipe.images else url_for('images', filename='no-image-available-icon-vector.jpg') }}" alt="{{ recipe.name }}" />
          <h3>{{ recipe.name }}</h3>
          <div class="recipe-meta">
            <span><strong>Cook Time:</strong> {{ recipe.cook_time }} mins</span>
            <span class="meta-divider">|</span>
            <span><strong>Quantity:</strong> Serves {{ recipe.servings }}</span>
          </div>
          <p>Rating: {{ '%.1f' % recipe.average_rating }}/5.0</p>
          <p class="author">by {{ recipe.user.display_name }}</p>
        </div>
      {% endfor %}
    </div>
  </div>

  <div class="top-profiles-section">
    <h2>Top Chefs</h2>
    <div class="profiles-grid">
      <!-- Top Chefs Section (based on # of recipes)-->
      {% for chef in top_chefs %}
      <div class="single-profile">
        <img src="{{ url_for('images', filename='profile_placeholder.jpg') }}" alt="{{ chef.display_name }}'s Profile Picture" />
        <h3 class="author">{{ chef.display_name }}</h3>
        <p>Total Recipes: {{ chef.total_recipes }}</p>
      </div>
      {% endfor %}
    </div>
  </div>
  
  <div class="reviews-section">
    <h2>Latest Reviews</h2>
    <div class="reviews">
      <!-- Latest Reviews Section -->
      {% for review, user, recipe in latest_reviews %}
      <div class="single-review">
        <img src="{{ url_for('images', filename='profile_placeholder.jpg') }}" alt="{{ user.display_name }}'s Profile Picture" />
        
        <div class="single-review-text">
          <div class="review-date">{{ review.created_at.strftime('%d-%m-%Y') }}</div>

          <p><strong>{{ user.display_name }}</strong> : 
            <a href="/recipe?id={{ recipe.id }}" class="recipe-link">{{ recipe.name }}</a>
          <p>{{ review.review or "No comment provided."}}</p>
          <p>Rating: {{ review.rating }}/5</p>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

</body>

</html>